import requests
from bs4 import BeautifulSoup, Comment
import time
import random

def get_clean_html(url: str) -> str:
    """Получает и очищает HTML страницы"""
    try:
        
        session = requests.Session()
        session.headers.update({
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
            "Accept-Language": "ru-RU,ru;q=0.9"
        })

        
        time.sleep(random.uniform(0.5, 1.5))
        response = session.get(url, timeout=10)
        response.raise_for_status()

       
        if 'text/html' not in response.headers.get('Content-Type', '').lower():
            return ""

  
        soup = BeautifulSoup(response.text, 'html.parser')
        
        
        for tag in soup(['script', 'style', 'noscript', 'link', 'meta', 'svg', 'iframe']):
            tag.decompose()
        
      
        for comment in soup.find_all(string=lambda text: isinstance(text, Comment)):
            comment.extract()
        
       
        for tag in soup.find_all(True):
            for attr in list(tag.attrs):
                if attr.lower().startswith('on') or attr.lower() in ['style', 'class']:
                    del tag.attrs[attr]
        
        return str(soup)

    except requests.exceptions.RequestException as e:
        print(f"Ошибка запроса: {e}")
        return ""
    except Exception as e:
        print(f"Ошибка обработки: {e}")
        return ""

def process_url(url: str):

    print(f"\nНачинаю обработку: {url}")
    
    html_content = get_clean_html(url)
    
    if html_content:
        print(f"Успешно получен HTML ({len(html_content)} символов)")
        
        # Сохраняем в файл
        with open('page_content.html', 'w', encoding='utf-8') as f:
            f.write(html_content)
        print("HTML сохранен в файл 'page_content.html'")
        
        return html_content
    else:
        print("Не удалось получить HTML")
        return ""

if __name__ == "__main__":

    target_url = "https://sever-rb.orb.ru/about"  
    
   
    html_result = process_url(target_url)
    

    if html_result:
    
        soup = BeautifulSoup(html_result, 'html.parser')
        print("\nАнализ страницы:")
        
        print(html_result)
